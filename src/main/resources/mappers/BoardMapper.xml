<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="board">

<!--  ===========================  게시판   ===============================  -->
	
	
	<!-- 게시판 리스트 출력 -->
	<select id="BoardList" parameterType="PageVO" resultType="BoardVO">
		<![CDATA[
		SELECT BDNUM, WRITER, TITLE, WRITEDATE
		FROM (
			SELECT 
				BDNUM, WRITER, TITLE, WRITEDATE,
				ROW_NUMBER() OVER(ORDER BY BDNUM DESC) AS rn
			FROM BOARDTABLE
		)
		WHERE rn between #{startPage} and #{endPage}
		ORDER BY BDNUM DESC
		]]>
	</select>
	
	<!-- 게시글 조회 -->
	<select id="selectBoard" parameterType="int" resultType="BoardVO">
		SELECT BDNUM, TITLE, WRITER, WRITEDATE, CONTENT, PW, ISUSER
		FROM BOARDTABLE
		WHERE BDNUM = #{bdnum}
	</select>
	
	<!-- 게시글 작성 -->
	<insert id="insertBoard" parameterType="BoardVO">
		INSERT INTO BOARDTABLE(
			BDNUM, 
			WRITER, 
			TITLE, 
			CONTENT,
			PW,
			ISUSER
		)
		VALUES(
			board_num_seq.nextval, 
			#{writer}, 
			#{title}, 
			#{content},
			#{pw},
			#{isuser}
		)
		<selectKey keyProperty="bdnum" resultType="int" order="AFTER">
			SELECT board_num_seq.CURRVAL FROM DUAL
		</selectKey>
	</insert>
	
	<!-- 게시글 삭제(유저) -->
	<delete id="deleteBoardUser" parameterType="BoardVO">
		DELETE FROM BOARDTABLE
		WHERE 
			WRITER = #{writer}
	</delete>
	
	<!-- 게시글 삭제(게스트) -->
	<delete id="deleteBoard" parameterType="BoardVO">
		DELETE FROM BOARDTABLE
		WHERE 
			PW = #{pw}
	</delete>
	
</mapper>